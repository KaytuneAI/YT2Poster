
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Youtubeè§†é¢‘æ‘˜è¦æµ·æŠ¥ç”Ÿæˆå™¨v1 by Kaytune k.AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'cream': '#F5E6D3',
            'teal': {
              600: '#2A7F7F',
              700: '#1F5F5F'
            },
            'orange': {
              600: '#D35F3F',
              700: '#B54F2F'
            },
            'forest': {
              600: '#3B7355',
              700: '#2A5740'
            },
            'brown': {
              600: '#8B4513',
              700: '#723710'
            }
          }
        }
      }
    }
  </script>
</head>
<body class="bg-gray-50 p-6">
  <div class="max-w-4xl mx-auto space-y-4">
    <div class="w-full mb-8">
      <img src="banner.jpg" alt="Youtubeè§†é¢‘ç”Ÿæˆæµ·æŠ¥" class="w-[1000px] object-cover rounded-lg shadow-lg">
    </div>
    <h1 class="text-2xl font-bold">ğŸ¬ Youtubeè§†é¢‘æ‘˜è¦æµ·æŠ¥ç”Ÿæˆå™¨v1 by Kaytune k.AI</h1>

    <input id="ytUrl" type="text" class="w-full p-2 border rounded" placeholder="è¾“å…¥ YouTube è§†é¢‘é“¾æ¥" />
    <button onclick="extractId()" class="mt-2 bg-teal-600 text-cream px-4 py-2 rounded w-full md:w-64 hover:bg-teal-700">ğŸ“¸ 1. æå–è§†é¢‘å°é¢å›¾å’ŒTitle</button>

    <div id="thumbnail" class="my-4"></div>

    <div id="apiKeySection">
      <div class="flex justify-between items-center mb-1">
        <input id="apikey" type="text" class="w-full p-2 border rounded mr-2" placeholder="è¯·è¾“å…¥ä½ çš„ DeepSeek API Key" />
        <a href="https://platform.deepseek.com/" target="_blank" class="text-blue-600 hover:text-blue-800 text-xs whitespace-nowrap">
          å¦‚ä½•ç”³è¯·Deepseek API
        </a>
      </div>
      <small class="text-gray-400 text-xs block mb-3">ä½ çš„ API Key ä»…ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨ï¼Œä¸ä¼šä¸Šä¼ </small>
    </div>

    <div id="apiKeySaved" class="hidden">
      <div class="flex justify-between items-center">
        <div class="text-gray-400 text-xs">ğŸ” API Key å·²ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨ï¼Œä¸ä¼šä¸Šä¼ </div>
        <button onclick="deleteApiKey()" class="text-xs text-red-500 hover:text-red-700 ml-2">ğŸ—‘ï¸ åˆ é™¤</button>
      </div>
    </div>

    
    <button onclick="fetchTranscript()" class="mt-2 bg-orange-600 text-cream px-4 py-2 rounded w-full md:w-64 hover:bg-orange-700">ğŸ“ 2. è‡ªåŠ¨è·å–å­—å¹•ä¸ä¸Šä¼ æ—¶é—´</button>

    <textarea id="transcript" rows="10" class="w-full p-2 border rounded" placeholder="ç²˜è´´ YouTube è½¬å½•å†…å®¹"></textarea>
    <button onclick="analyzeTranscript()" class="mt-2 bg-forest-600 text-cream px-4 py-2 rounded w-full md:w-64 hover:bg-forest-700">ğŸª„ 3. ç”Ÿæˆæ‘˜è¦ä¸æ•…äº‹</button>

    <div id="poster" class="mt-6 p-4 border rounded bg-white shadow"></div>
    <button onclick="exportPoster()" class="mt-4 bg-brown-600 text-cream px-4 py-2 rounded hover:bg-brown-700 w-full md:w-64">
      ğŸ“¸ 4. å¯¼å‡ºæµ·æŠ¥
    </button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
// åœ¨é¡µé¢åŠ è½½æ—¶å°è¯•æ¢å¤ä¹‹å‰ä¿å­˜çš„ Key
window.addEventListener('DOMContentLoaded', () => {
  const savedKey = localStorage.getItem("deepseek_api_key");
  if (savedKey) {
    document.getElementById("apikey").value = savedKey;
    document.getElementById("apiKeySection").classList.add("hidden");
    document.getElementById("apiKeySaved").classList.remove("hidden");
  }
});

// ä¿®æ”¹ä¿å­˜API Keyçš„é€»è¾‘
function saveApiKey(apiKey) {
  localStorage.setItem("deepseek_api_key", apiKey);
  document.getElementById("apiKeySection").classList.add("hidden");
  document.getElementById("apiKeySaved").classList.remove("hidden");
}

// åœ¨extractIdå‡½æ•°ä¸­ä¿®æ”¹API KeyéªŒè¯éƒ¨åˆ†
async function extractId() {
      const button = document.querySelector('button');
      button.disabled = true;
      button.innerHTML = 'æ­£åœ¨æå–...';

      const url = document.getElementById('ytUrl').value;
      const match = url.match(/(?:v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
      if (match) {
        videoId = match[1];
        
        try {
          // è·å–è§†é¢‘ä¿¡æ¯
          const response = await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${videoId}&format=json`);
          const data = await response.json();
          const title = data.title;
          const channelTitle = data.author_name;
          const channelUrl = data.author_url;
          
          // ä¿å­˜é¢‘é“ä¿¡æ¯ä¾›åç»­ä½¿ç”¨
          window.channelInfo = {
            title: channelTitle,
            url: channelUrl
          };

          // è·å–å¹¶éªŒè¯ API Key
          const apiKey = document.getElementById("apikey").value.trim();
          if (!apiKey && !localStorage.getItem("deepseek_api_key")) {
            alert("è¯·å…ˆè¾“å…¥ API Keyï¼");
            button.disabled = false;
            button.innerHTML = 'ğŸ“¸ 1. æå–è§†é¢‘å°é¢å›¾å’ŒTitle';
            return;
          }
          if (apiKey) {
            saveApiKey(apiKey);
          }
          localStorage.setItem("deepseek_api_key", apiKey);

          // ç¿»è¯‘æ ‡é¢˜
          const res = await fetch("https://api.deepseek.com/v1/chat/completions", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": `Bearer ${apiKey}`
            },
            body: JSON.stringify({
              model: "deepseek-chat",
              messages: [{ 
                role: "user", 
                content: `è¯·å°†è¿™ä¸ªYouTubeè§†é¢‘æ ‡é¢˜ç¿»è¯‘æˆä¸­æ–‡ï¼Œå’ŒåŸå…ˆé•¿åº¦å·®ä¸å¤šï¼Œéœ€è¦ç¬¦åˆè‹±æ–‡æ ‡é¢˜çš„å†…å®¹ï¼Œç®€ä»‹ä½†ç¬¦åˆç¤¾äº¤ä¼ æ’­,ä¸è¦å‘Šè¯‰æˆ‘æ¨ç†è¿‡ç¨‹ï¼š${title}` 
              }],
              temperature: 0.7
            })
          });

          const translationData = await res.json();
          const translatedTitle = translationData.choices[0].message.content.trim();

          // ä¿å­˜æ ‡é¢˜ä¾›åç»­ä½¿ç”¨
          window.videoTitle = {
            original: title,
            translated: translatedTitle
          };

          const imgUrl = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;
          document.getElementById('thumbnail').innerHTML = `
            <div class="space-y-2 mb-4">
              <h2 class="text-xl font-bold" contenteditable="true" id="editableTitle">${translatedTitle}</h2>
              <p class="text-gray-600 text-sm">${title}</p>
            </div>
            <img src="${imgUrl}" class="w-full rounded shadow" alt="å°é¢å›¾" />
            <p class="text-sm text-blue-600 mt-2">
              <a href="https://www.youtube.com/watch?v=${videoId}" target="_blank">è®¿é—®åŸå§‹è§†é¢‘</a>
            </p>
          `;

          // æ·»åŠ æ ‡é¢˜ç¼–è¾‘äº‹ä»¶ç›‘å¬
          document.getElementById('editableTitle').addEventListener('input', function(e) {
            window.videoTitle.translated = e.target.innerText;
          });

        } catch (error) {
          console.error('è·å–è§†é¢‘ä¿¡æ¯å¤±è´¥:', error);
          // å¦‚æœè·å–æ ‡é¢˜å¤±è´¥ï¼Œä»ç„¶æ˜¾ç¤ºå°é¢å›¾
          const imgUrl = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;
          document.getElementById('thumbnail').innerHTML = `
            <img src="${imgUrl}" class="w-full rounded shadow" alt="å°é¢å›¾" />
            <p class="text-sm text-blue-600 mt-2">
              <a href="https://www.youtube.com/watch?v=${videoId}" target="_blank">è®¿é—®åŸå§‹è§†é¢‘</a>
            </p>
          `;
        }
      } else {
        alert("æ— æ•ˆçš„é“¾æ¥æ ¼å¼ï¼");
      }

      button.disabled = false;
      button.innerHTML = 'ğŸ“¸ 1. æå–è§†é¢‘å°é¢å›¾å’ŒTitle';
    }

    async function analyzeTranscript() {
      const button = document.querySelector('button:last-of-type');
      const poster = document.getElementById('poster');
      
      button.disabled = true;
      button.innerHTML = 'åˆ†æä¸­...';
      
      poster.innerHTML = `
        <div class="flex items-center justify-center p-4">
          <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"></div>
          <span class="ml-2 text-gray-600">æ­£åœ¨åˆ†æå†…å®¹ï¼Œè¯·ç¨å€™...</span>
        </div>
      `;

      const transcript = document.getElementById('transcript').value.trim();
      if (!transcript) {
        button.disabled = false;
        button.innerHTML = 'ç”Ÿæˆæ‘˜è¦ä¸æ•…äº‹';
        poster.innerHTML = '';
        return alert("è¯·ç²˜è´´è½¬å½•å†…å®¹");
      }

      const prompt = `ä»¥ä¸‹æ˜¯ä¸€ä¸ªè®¿è°ˆèŠ‚ç›®çš„å®Œæ•´è½¬å½•æ–‡æœ¬ã€‚è¯·å¸®æˆ‘å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š\n\n1. ç”¨ä¸­æ–‡å†™ä¸€æ®µ  300 å­—çš„æ‘˜è¦ï¼Œçªå‡ºè¯¥è§†é¢‘çš„æ ¸å¿ƒå†…å®¹å’Œä¸»é¢˜ã€‚\n2. æå–å¹¶æ”¹å†™äº”ä¸ªç²¾å½©ç‰‡æ®µæˆ–æœ‰è¶£çš„æ•…äº‹ï¼ˆæ¯æ®µçº¦ 200å­—ï¼‰ï¼Œç”¨ä¸­æ–‡è¡¨è¾¾ï¼Œé€‚åˆç”¨äºç¤¾äº¤åª’ä½“å®£ä¼ ã€‚ä½†æ˜¯ç”Ÿæˆçš„æ–‡å­—ä¸ç”¨æåŠå¤šå°‘å­—ï¼Œåœ¨å¼€å¤´ä¸è¦æåŠæ‘˜è¦å‡ ç™¾å­—è¿™æ ·çš„è¯ï¼Œåœ¨ç»“å°¾ä¹Ÿä¸è¦æåŠæœ‰äº”æ®µç¤¾äº¤åª’ä½“çš„çš„å®£ä¼ æ–‡æ¡ˆç±»ä¼¼çš„å­—çœ¼ \n\nè®¿è°ˆåŸæ–‡ï¼š\n${transcript}`;

      try {
        // è·å–å¹¶éªŒè¯ API Key
        const apiKey = document.getElementById("apikey").value.trim();
        if (!apiKey) {
          alert("è¯·å…ˆè¾“å…¥ API Keyï¼");
          button.disabled = false;
          button.innerHTML = 'ç”Ÿæˆæ‘˜è¦ä¸æ•…äº‹';
          return;
        }
        localStorage.setItem("deepseek_api_key", apiKey);

        const res = await fetch("https://api.deepseek.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: "deepseek-chat",
            messages: [{ role: "user", content: prompt }],
            temperature: 0.7
          })
        });

        if (!res.ok) {
          const errorData = await res.json();
          throw new Error(`API å“åº”é”™è¯¯ï¼š${errorData.error?.message || 'æœªçŸ¥é”™è¯¯'}`);
        }

        const data = await res.json();
        const content = data.choices?.[0]?.message?.content || '';
        
        // æ¸…ç†æç¤ºæ–‡æœ¬çš„é€šç”¨å‡½æ•°
        function cleanPromptText(text) {
          const patterns = [
            /[#*]+/g,                                    // æ¸…ç†#å’Œ*ç¬¦å·
            /äº”ä¸ªç¤¾äº¤åª’ä½“å®£ä¼ ç‰‡æ®µ/g,                     // æ¸…ç†å…·ä½“æç¤ºæ–‡æœ¬
            /---\s*ç¤¾äº¤åª’ä½“(ç²¾å½©|å®£ä¼ )ç‰‡æ®µ[ï¼ˆ(]\d+æ®µ[ï¼‰)]/g,  // æ¸…ç†å¸¦æ•°å­—çš„ç‰‡æ®µæç¤º
            /ç¤¾äº¤åª’ä½“(ç²¾å½©|å®£ä¼ )ç‰‡æ®µï¼š?/g,               // æ¸…ç†ä¸å¸¦æ•°å­—çš„ç‰‡æ®µæç¤º
            /\n{2,}/g,                                   // æ¸…ç†å¤šä½™ç©ºè¡Œ
            /^[\s\n]*|[\s\n]*$/g                        // æ¸…ç†é¦–å°¾ç©ºç™½
          ];
          
          return patterns.reduce((text, pattern) => {
            return text.replace(pattern, '');
          }, text);
        }
        
        // ä½¿ç”¨æ¸…ç†å‡½æ•°å¤„ç†å†…å®¹
        const cleanContent = cleanPromptText(content);
        
        // åˆ†å‰²å†…å®¹
        const parts = cleanContent.split(/\n?\d[\.\ã€\)]\s?/).filter(Boolean);
        const summary = parts[0] || '';
        const stories = parts.slice(1);

        // è·å–å½“å‰è§†é¢‘URL
        const videoUrl = `https://www.youtube.com/watch?v=${videoId}`;
        
        
let html = `
<div class="bg-white p-6 space-y-4 max-w-3xl mx-auto">
  <h1 class="text-4xl font-extrabold text-center text-gray-900">
    ${window.videoTitle?.translated || 'è§†é¢‘æ ‡é¢˜ï¼ˆç‚¹å‡»ä¿®æ”¹ï¼‰'}
  </h1>

  <div class="text-center space-y-1">
    <div class="text-base text-gray-900">
      Youtubeé¢‘é“ï¼š
      <a href="${window.channelInfo?.url || '#'}" target="_blank" class="hover:text-orange-600 font-medium">
        ${window.channelInfo?.title || 'æœªçŸ¥é¢‘é“'}
      </a>
    </div>
    <div class="text-sm text-gray-900">
      æ—¥æœŸï¼š${window.uploadedAt || 'æœªçŸ¥æ—¶é—´'}
    </div>
  </div>

  <div class="w-full flex justify-center">
    <img src="https://img.youtube.com/vi/${videoId}/maxresdefault.jpg" 
         onerror="this.src='https://img.youtube.com/vi/${videoId}/hqdefault.jpg';"
         class="rounded-lg shadow-md max-w-full w-[75%]" />
  </div>

  <div class="text-center space-y-2 mb-4">
    
    <div class="text-sm text-gray-500 break-all">
      è§†é¢‘é“¾æ¥ï¼š${videoUrl}
    </div>
  </div>

  <div class="bg-teal-50 p-4 rounded text-base text-gray-800 leading-relaxed" contenteditable="true">
    ğŸ“ <strong class="text-teal-600">å†…å®¹æ‘˜è¦</strong><br>${summary}
  </div>

  <div class="space-y-4">
    <h2 class="text-xl font-semibold text-forest-600">ğŸ¯ ç²¾å½©æ•…äº‹</h2>
    <ul class="space-y-4 text-base text-gray-800">
      ${stories.map((story, i) => {
        const lines = story.split('\n');
        const title = lines[0];
        const content = lines.slice(1).join('\n');
        return `
          <li class="bg-cream/20 rounded p-4" contenteditable="true">
            <div class="flex items-start gap-3">
              <div class="bg-orange-600 text-cream rounded-full w-8 h-8 flex items-center justify-center text-base font-bold flex-shrink-0">${i + 1}</div>
              <div class="flex-1">
                <h3 class="text-2xl font-bold text-brown-600 mb-3">${title}</h3>
                <p class="text-gray-700 leading-relaxed">${content}</p>
              </div>
            </div>
          </li>`;
      }).join('')}
    </ul>
  </div>

  <div class="text-center text-sm text-teal-600/70 mt-8 pt-4 border-t border-teal-100">
    âœ¨ æœ¬æ‘˜è¦ç”±å‡¯æ·³Kaytune k.AIæ™ºèƒ½ä½“ç”Ÿæˆï¼Œç‰ˆæƒç”±åŸYoutubeé¢‘é“æ‰€æœ‰ã€‚
    <br>
    æœ¬æ‘˜è¦ä»…ç”¨äºå­¦ä¹ äº¤æµï¼Œä¸å¾—ç”¨äºä»»ä½•å•†ä¸šç›®çš„ã€‚
  </div>
</div>
`;

    document.getElementById("poster").innerHTML = html;

      } catch (err) {
        console.error('API è°ƒç”¨é”™è¯¯:', err);
        poster.innerHTML = `<div class="text-red-500">è°ƒç”¨ DeepSeek API å¤±è´¥ï¼š${err.message}</div>`;
      } finally {
        button.disabled = false;
        button.innerHTML = 'ç”Ÿæˆæµ·æŠ¥';
      }
    }
  </script>
  <script>
    async function exportPoster() {
      const button = document.querySelector('button[onclick="exportPoster()"]');
      const originalText = button.innerHTML;
      
      try {
        button.disabled = true;
        button.innerHTML = 'ğŸ“¸ æ­£åœ¨ç”Ÿæˆå›¾ç‰‡...';
        
        const poster = document.getElementById("poster");
        if (!poster.innerHTML.trim()) {
          throw new Error('æµ·æŠ¥å†…å®¹ä¸ºç©ºï¼Œè¯·å…ˆç”Ÿæˆæµ·æŠ¥å†…å®¹ï¼');
        }
        
        const canvas = await html2canvas(poster, { 
          scale: 2,
          logging: false,
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#ffffff'
        });
        
        const link = document.createElement("a");
        link.download = `poster-${videoId || Date.now()}.png`;
        link.href = canvas.toDataURL("image/png");
        link.click();
        
        button.innerHTML = 'âœ… å¯¼å‡ºæˆåŠŸï¼';
        setTimeout(() => {
          button.innerHTML = originalText;
        }, 2000);
      } catch (err) {
        console.error('å¯¼å‡ºå¤±è´¥:', err);
        button.innerHTML = 'âŒ å¯¼å‡ºå¤±è´¥';
        alert(`å¯¼å‡ºå¤±è´¥ï¼š${err.message}`);
        setTimeout(() => {
          button.innerHTML = originalText;
        }, 2000);
      } finally {
        button.disabled = false;
      }
    }

    // æ·»åŠ åˆ é™¤API Keyçš„å‡½æ•°
    function deleteApiKey() {
      if (confirm('ç¡®å®šè¦åˆ é™¤ä¿å­˜çš„API Keyå—ï¼Ÿåˆ é™¤åéœ€è¦é‡æ–°è¾“å…¥ã€‚')) {
        localStorage.removeItem("deepseek_api_key");
        document.getElementById("apikey").value = '';
        document.getElementById("apiKeySection").classList.remove("hidden");
        document.getElementById("apiKeySaved").classList.add("hidden");
      }
    }
  </script>
</body>
</html>


</script>
<script>
async function fetchTranscript() {
  const url = document.getElementById("ytUrl").value.trim();
  if (!url) return alert("1. è¯·å…ˆè¾“å…¥ YouTube è§†é¢‘é“¾æ¥");

  try {
    const button = document.querySelector('button[onclick="fetchTranscript()"]');
    button.disabled = true;
    button.innerHTML = "â³ è·å–ä¸­...";

    const match = url.match(/(?:v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
    const videoId = match ? match[1] : null;
    if (!videoId) throw new Error("æ— æ•ˆçš„ YouTube é“¾æ¥");

    const transcriptRes = await fetch("/transcript?videoId=" + videoId);
    const transcriptJson = await transcriptRes.json();
    if (transcriptJson.error) throw new Error(transcriptJson.error);
    const cleaned = transcriptJson.transcript;

    const dateRes = await fetch("/published_at?videoId=" + videoId);
    const dateJson = await dateRes.json();
    if (dateJson.error) throw new Error(dateJson.error);
    
    // ä¿å­˜ä¸Šä¼ æ—¶é—´ä¾›åç»­ä½¿ç”¨
    window.uploadedAt = dateJson.publishedAt;
    document.getElementById("transcript").value = cleaned;

  } catch (err) {
    console.error("å­—å¹•è·å–å¤±è´¥ï¼š", err);
    alert("å­—å¹•è·å–å¤±è´¥ï¼š" + err.message);
  } finally {
    const button = document.querySelector('button[onclick="fetchTranscript()"]');
    button.disabled = false;
    button.innerHTML = "ğŸ“ 2. è‡ªåŠ¨è·å–å­—å¹•ä¸ä¸Šä¼ æ—¶é—´";
  }
}
</script>
</body>
</html>


</script>
